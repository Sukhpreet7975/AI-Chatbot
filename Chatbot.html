<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Generator ChatBot - Professional</title>
    <!-- Favicon for the page -->
    <link rel="icon" type="image/png" href="robot.png">

    <!-- External CSS Libraries -->
    <!-- Bootstrap 5 for layout and components -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <!-- Bootstrap Icons for iconography -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Marked.js for rendering Markdown content in the chat -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* --- CSS Custom Properties (Variables) for Theming --- */
        :root {
            /* Color Palette */
            --primary-color: #17a2b8; /* Teal */
            --primary-hover: #138496; /* Darker Teal */
            --secondary-color: #494e54; /* Mid Grey */
            --light-bg: #f8f9fa; /* Very Light Grey */
            --white: #ffffff;
            --dark-text: #343a40; /* Dark Grey/Black */
            --muted-text: #6c757d; /* Mid Grey */
            --border-color: #dee2e6; /* Light Grey Border */
            --user-msg-bg: #e2f3f5; /* Light Teal */
            --bot-msg-bg: var(--white);
            --user-msg-label: var(--primary-hover);
            --bot-msg-label: var(--primary-color);
            --link-color: var(--primary-color);
            --typing-dot-color: var(--secondary-color);
            --accordion-header-bg: var(--white);
            --accordion-active-bg: var(--primary-color);
            --accordion-active-color: var(--white);
            --blockquote-border: var(--primary-color);
            --chat-body-bg: #f1f5f9; /* Slightly different chat body background */

            /* Shadows & Borders */
            --shadow-sm: 0 .125rem .25rem rgba(0, 0, 0, .075);
            --shadow-md: 0 .5rem 1rem rgba(0, 0, 0, .15);
            --border-radius-sm: 0.25rem;
            --border-radius-md: 0.5rem;
            --border-radius-lg: 0.8rem;
        }

        /* --- General Body Styling --- */
        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            color: var(--dark-text);
            background-color: var(--white);
            line-height: 1.6;
        }

        /* --- Hero Section --- */
        .hero {
            background-color: var(--light-bg);
            color: var(--dark-text);
            text-align: center;
            padding: 100px 20px;
        }
        .hero h1 {
            font-weight: 600;
            margin-bottom: 0.75rem;
        }
        .hero p.lead {
             color: var(--muted-text);
             font-size: 1.15rem;
        }
        #logo {
            width: 90px;
            height: auto;
            margin-bottom: 20px;
            border-radius: var(--border-radius-sm);
        }

        /* --- General Section Styling --- */
        section {
             padding-top: 60px;
             padding-bottom: 60px;
        }
        /* Background color for alternating sections */
        .section-bg {
            background-color: var(--light-bg);
        }
        /* Centered section title */
        h2.section-title {
            text-align: center;
            margin-bottom: 40px;
            font-weight: 600;
            color: var(--dark-text);
        }

        /* --- Feature & How-It-Works Cards --- */
        .feature-card, .how-card {
             border: 1px solid var(--border-color);
             padding: 25px;
             border-radius: var(--border-radius-md);
             background-color: var(--white);
             box-shadow: var(--shadow-sm);
             transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
             height: 100%; /* Ensure cards in a row have same height */
             display: flex;
             flex-direction: column;
             align-items: center; /* Center content */
             text-align: center;
        }
        /* Hover effect for cards */
        .feature-card:hover, .how-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }
        /* Card headings */
        .feature-card h4, .how-card h5 {
             color: var(--primary-color);
             font-weight: 600;
             margin-bottom: 10px;
             font-size: 1.2rem;
        }
         /* Card paragraph text */
         .feature-card p, .how-card p {
              color: var(--muted-text);
              font-size: 0.95rem;
         }

        /* --- Contact Section --- */
        .contact-section {
            text-align: center;
        }
        .contact-section h1 b {
             font-weight: 600;
        }
         .contact-section h2 {
             font-weight: 600;
         }
        /* Specific styling for developer names paragraph (as requested in original) */
        #para {
            text-decoration: underline;
            color: #dc3545; /* Using red as originally specified, consider changing to a theme color */
            font-weight: bold;
        }

        /* --- Chatbot Toggle Button --- */
        .chat-toggle-btn {
            position: fixed; /* Keeps button in viewport */
            bottom: 25px;
            right: 25px;
            background: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 50%; /* Makes it circular */
            width: 65px;
            height: 65px;
            font-size: 28px; /* Icon size */
            cursor: pointer;
            box-shadow: var(--shadow-md);
            z-index: 1050; /* Ensures button is above most other content */
            display: flex;
            justify-content: center;
            align-items: center;

            /* Styles for smooth fade transition when chat opens/closes */
            opacity: 1;
            visibility: visible;
            transition: background-color 0.3s ease, transform 0.2s ease, opacity 0.3s ease, visibility 0.3s ease;
        }
        /* Hover effect for toggle button */
        .chat-toggle-btn:hover {
             background: var(--primary-hover);
             transform: scale(1.05);
        }
        /* Ensure icon inside button is centered */
        .chat-toggle-btn svg, .chat-toggle-btn i {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- Chatbot Container --- */
        .chat-container {
            position: fixed; /* Keeps chat window in viewport */
            bottom: 30px;
            right: 30px;
            width: 450px;
            height: 600px;
            max-height: calc(100vh - 60px); /* Prevents overflow on smaller screens */
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            display: none; /* Initially hidden */
            flex-direction: column; /* Stacks header, body, footer vertically */
            z-index: 1040; /* Below toggle button but above most content */
            border: 1px solid var(--border-color);
            overflow: hidden; /* Clips content overflowing the rounded corners */
        }

        /* --- Chatbot Header --- */
        .chat-header {
            display: flex;
            justify-content: space-between; /* Title left, close button right */
            align-items: center;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--primary-color);
            color: var(--white);
            cursor: grab; /* Indicates draggable */
            flex-shrink: 0; /* Prevents header from shrinking */
        }
        /* Cursor change during drag */
        .chat-header:active {
             cursor: grabbing;
        }
        /* Close button ('✕') styling */
        .chat-close {
            cursor: pointer;
            font-size: 24px;
            font-weight: normal;
            padding: 0 5px;
            line-height: 1;
            color: rgba(255, 255, 255, 0.8); /* Slightly transparent */
            transition: color 0.2s ease;
        }
        .chat-close:hover {
             color: var(--white); /* Opaque on hover */
        }

        /* --- Chatbot Body (Message Area) --- */
        .chat-body {
            flex-grow: 1; /* Takes up available vertical space */
            overflow-y: auto; /* Enables scrolling for messages */
            padding: 20px;
            background: var(--chat-body-bg);
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }

        /* --- General Chat Message Styling --- */
        .chat-body p {
            margin-bottom: 12px;
            line-height: 1.5;
            max-width: 100%; /* Prevents overflow */
            word-wrap: break-word; /* Breaks long words */
            padding: 12px 18px;
            border-radius: var(--border-radius-md);
        }
         /* Styling for sender labels (e.g., "You:", "Bot:") */
         .chat-body p b {
            display: block; /* Puts label on its own line */
            margin-bottom: 4px;
            font-size: 0.85em;
            font-weight: 600;
            opacity: 0.9;
         }
         /* Remove bottom margin from the very last message */
         .chat-body p:last-child {
             margin-bottom: 0;
         }

         /* --- User Message Specific Styling --- */
         .you-message {
             text-align: left;
             margin-left: 45px; /* Indent user message */
             margin-right: 0;
             background-color: var(--user-msg-bg);
             /* "Tail" effect - bottom-left corner is square */
             border-radius: var(--border-radius-md) var(--border-radius-md) 0 var(--border-radius-md);
         }
         .you-message b {
            color: var(--user-msg-label); /* Specific color for "You:" label */
         }

         /* --- Bot Message Specific Styling --- */
         .bot-message {
             text-align: left;
             margin-right: 45px; /* Indent bot message */
             margin-left: 0;
             background-color: var(--bot-msg-bg);
              /* "Tail" effect - bottom-right corner is square */
             border-radius: var(--border-radius-md) var(--border-radius-md) var(--border-radius-md) 0;
             border: 1px solid var(--border-color);
             box-shadow: var(--shadow-sm);
         }
          .bot-message b {
             color: var(--bot-msg-label); /* Specific color for "Bot:" label */
         }

         /* --- Markdown Content Styling (within Bot Messages) --- */
         /* Target the span wrapping the markdown content */
         .bot-message > span {
             display: block;
         }
         /* Reset parent paragraph styles and apply base styles for markdown elements */
         .bot-message span p,
         .bot-message span ul,
         .bot-message span ol,
         .bot-message span pre,
         .bot-message span blockquote,
         .bot-message span table {
             margin-bottom: 10px !important; /* Tighter spacing within markdown */
             line-height: 1.5;
             background: none;
             padding: 0;
             border: none;
             box-shadow: none;
             color: inherit; /* Inherit text color from parent */
             font-size: inherit; /* Inherit font size */
             text-align: left; /* Ensure left alignment */
         }
         /* Specific Markdown element styling */
         .bot-message span ul, .bot-message span ol { padding-left: 25px; margin-bottom: 10px; }
         .bot-message span li { margin-bottom: 6px; }
         .bot-message span blockquote { border-left: 3px solid var(--blockquote-border); padding-left: 15px; margin-left: 0; color: var(--muted-text); font-style: italic; background: none; }
         .bot-message span code:not(pre code) { background-color: #e9ecef; padding: 2px 5px; border-radius: var(--border-radius-sm); font-size: 0.9em; font-family: monospace; color: #c7254e; }
         .bot-message span pre { background-color: #f1f1f1; color: var(--dark-text); padding: 12px; border-radius: var(--border-radius-sm); border: 1px solid var(--border-color); overflow-x: auto; font-family: monospace; font-size: 0.85em; line-height: 1.4; }
         .bot-message span pre code { padding: 0; background: none; color: inherit; border: none; font-size: inherit; }
         .bot-message span table { border-collapse: collapse; width: 100%; margin-bottom: 12px; font-size: 0.9em; }
         .bot-message span th, .bot-message span td { border: 1px solid var(--border-color); padding: 6px 10px; text-align: left; }
         .bot-message span th { background-color: var(--light-bg); font-weight: 600; }

        /* --- Chatbot Footer (Input Area) --- */
        .chat-footer {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            background: var(--white);
            flex-shrink: 0; /* Prevents footer from shrinking */
        }
        /* Text input field */
        .chat-footer input[type="text"] {
            flex-grow: 1; /* Takes up available horizontal space */
            margin-right: 10px;
            border-radius: var(--border-radius-md);
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            font-size: 0.95rem;
            background-color: var(--white);
        }
         /* Focus style for input field */
         .chat-footer input[type="text"]:focus {
             border-color: var(--primary-color);
             box-shadow: 0 0 0 0.2rem rgba(23, 162, 184, 0.25); /* Teal focus ring */
             outline: none;
         }
        /* Send button */
        .chat-footer .btn-send {
             flex-shrink: 0; /* Prevents button from shrinking */
             border-radius: var(--border-radius-md);
             width: 42px;
             height: 42px;
             padding: 0;
             display: flex;
             justify-content: center;
             align-items: center;
             background-color: var(--primary-color);
             border: none;
             transition: background-color 0.2s ease;
        }
        .chat-footer .btn-send:hover {
             background-color: var(--primary-hover);
        }
        /* Icon inside send button */
        .chat-footer .btn-send svg, .chat-footer .btn-send i { width: 18px; height: 18px; color: var(--white); }

        /* --- Typing Indicator Animation --- */
        /* Keyframes for the dot animation */
        @keyframes bubbleAnimation {
            0%, 100% { transform: translateY(0); opacity: 0.6; }
            50% { transform: translateY(-3px); opacity: 1; }
        }
        /* Styling for the animated dots */
        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: var(--typing-dot-color);
            border-radius: 50%;
            margin: 0 2px;
            animation: bubbleAnimation 1.2s infinite ease-in-out;
        }
        /* Stagger the animation start times for the dots */
        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.15s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.3s; }
        /* Container for the typing indicator, styled like a bot message */
        #typingIndicator {
            color: var(--muted-text);
            font-style: italic;
            margin-right: 45px; /* Indent like bot message */
            padding: 12px 18px; /* Match message padding */
            background-color: var(--bot-msg-bg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
             /* "Tail" effect */
            border-radius: var(--border-radius-md) var(--border-radius-md) var(--border-radius-md) 0;
        }
        /* Styling for the "Bot:" label within the indicator */
        #typingIndicator b {
            font-style: normal;
            margin-right: 5px;
            color: var(--bot-msg-label);
            font-size: 0.85em;
            font-weight: 600;
            opacity: 0.9;
        }

        /* --- FAQ Accordion Styling (Bootstrap Override/Customization) --- */
        .accordion-item {
             margin-bottom: 10px;
             border: 1px solid var(--border-color);
             border-radius: var(--border-radius-sm);
             overflow: hidden; /* Ensures border-radius applies correctly */
        }
         /* Remove default Bootstrap accordion header margin */
         .accordion-header {
             margin-bottom: 0;
         }
        /* Accordion button (the clickable header) */
        .accordion-button {
             font-weight: 500;
             color: var(--dark-text);
             background-color: var(--accordion-header-bg);
             border-bottom: 1px solid var(--border-color); /* Separator line */
             padding: 1rem 1.25rem;
             width: 100%;
             text-align: left;
             border: none; /* Remove default button border */
        }
         /* Styles for the button when the accordion item is open (not collapsed) */
         .accordion-button:not(.collapsed) {
              color: var(--accordion-active-color);
              background-color: var(--accordion-active-bg);
              box-shadow: inset 0 -1px 0 rgba(0, 0, 0, .125); /* Standard Bootstrap shadow */
              border-bottom-color: var(--accordion-active-bg); /* Hide border when open */
         }
         /* Focus style for accordion button */
         .accordion-button:focus {
              box-shadow: 0 0 0 0.2rem rgba(23, 162, 184, 0.25); /* Teal focus ring */
              z-index: 3; /* Ensure focus style is visible */
              outline: none;
         }
         /* Styling for the accordion arrow icon (using Bootstrap's SVG) */
         .accordion-button::after {
             background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%236c757d'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
             flex-shrink: 0;
             width: 1.25rem;
             height: 1.25rem;
             margin-left: auto;
             content: "";
             background-repeat: no-repeat;
             background-size: 1.25rem;
             transition: transform .2s ease-in-out; /* Animate arrow rotation */
         }
         /* Arrow icon style when accordion item is open */
         .accordion-button:not(.collapsed)::after {
              background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23ffffff'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
             transform: rotate(-180deg); /* Rotate arrow upwards */
         }
        /* Accordion body content area */
        .accordion-body {
             background-color: var(--white);
             padding: 1rem 1.25rem;
             font-size: 0.95rem;
             color: var(--muted-text);
        }

        /* --- General Link Styling --- */
        a {
           color: var(--link-color);
           text-decoration: none; /* Remove underline by default */
           transition: color 0.2s ease;
        }
        a:hover {
           color: var(--primary-hover);
           text-decoration: underline; /* Add underline on hover */
        }

        /* --- Responsive Adjustments --- */
        /* Medium devices (tablets, 768px and down) */
        @media (max-width: 768px) {
            .chat-container { width: calc(100% - 40px); max-width: 450px; height: calc(100vh - 80px); max-height: 550px; bottom: 90px; right: 20px; }
             .hero { padding: 80px 15px; }
             section { padding-top: 40px; padding-bottom: 40px; }
             .feature-card, .how-card { margin-bottom: 20px; } /* Add space between stacked cards */
        }
        /* Small devices (phones, 480px and down) */
        @media (max-width: 480px) {
             body { font-size: 0.95rem; } /* Slightly smaller base font */
             .chat-container { width: calc(100% - 20px); right: 10px; bottom: 80px; height: calc(100vh - 90px); }
             .chat-toggle-btn { width: 60px; height: 60px; bottom: 15px; right: 15px; }
             .hero { padding: 60px 15px; }
             h1.display-4 { font-size: 2.2rem; } /* Smaller hero heading */
             .hero p.lead { font-size: 1rem; } /* Smaller hero lead text */
             .feature-card h4, .how-card h5 { font-size: 1.1rem; } /* Smaller card headings */
             /* Reduce message indentation */
             .you-message { margin-left: 10px; }
             .bot-message { margin-right: 10px; }
             #typingIndicator { margin-right: 10px; }
             /* Adjust chat footer */
             .chat-footer { padding: 10px 15px; }
             .chat-footer input[type="text"] { padding: 8px 12px; font-size: 0.9rem; }
             .chat-footer .btn-send { width: 38px; height: 38px; }
             .chat-footer .btn-send svg, .chat-footer .btn-send i { width: 16px; height: 16px; }
             /* Adjust chat message padding */
             .chat-body p { padding: 10px 15px; }
             /* Adjust accordion padding/font size */
             .accordion-button { font-size: 0.9rem; padding: 0.8rem 1rem; }
             .accordion-body { font-size: 0.9rem; padding: 0.8rem 1rem; }
        }

    </style>
</head>

<body>

    <!-- Hero Section: Introduces the chatbot -->
    <section class="hero">
        <div class="container">
            <img id="logo" src="robot.png" alt="Invoice Bot Icon">
            <h1 class="display-4">Invoice Generator ChatBot</h1>
            <p class="lead">Your AI assistant for creating and managing invoices quickly and professionally.</p>
        </div>
    </section>

    <!-- Features Section: Highlights key benefits -->
    <section class="section-bg">
        <div class="container">
            <h2 class="section-title mb-5">Why Use Invoice Generator ChatBot?</h2>
            <div class="row justify-content-center">
                <!-- Feature 1: Quick Creation -->
                <div class="col-md-4 mb-4">
                     <div class="feature-card">
                         <h4><i class="bi bi-lightning-charge-fill me-2"></i> Quick Creation</h4>
                         <p>Generate professional invoices in seconds via chat.</p>
                     </div>
                </div>
                <!-- Feature 2: Detail Management -->
                <div class="col-md-4 mb-4">
                     <div class="feature-card">
                         <h4><i class="bi bi-card-list me-2"></i> Detail Management</h4>
                         <p>Easily input client info, items, prices, and terms.</p>
                    </div>
                </div>
                <!-- Feature 3: Simulated Sending -->
                <div class="col-md-4 mb-4">
                    <div class="feature-card">
                        <h4><i class="bi bi-send-check-fill me-2"></i> Send & Track (Simulated)</h4>
                        <p>Simulate sending invoices and get confirmation.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works Section: Simple steps to use the bot -->
    <section>
        <div class="container">
            <h2 class="section-title mb-5">How It Works</h2>
            <div class="row text-center">
                <!-- Step 1 -->
                <div class="col-md-4 mb-4">
                     <div class="how-card">
                        <h5><span class="badge bg-primary rounded-pill me-2">1</span> Open ChatBot</h5>
                         <p>Click the <i class="bi bi-chat-right-text"></i> button below.</p>
                     </div>
                </div>
                <!-- Step 2 -->
                <div class="col-md-4 mb-4">
                     <div class="how-card">
                        <h5><span class="badge bg-primary rounded-pill me-2">2</span> Provide Details</h5>
                         <p>Tell the bot the client, items, prices, etc.</p>
                    </div>
                </div>
                <!-- Step 3 -->
                <div class="col-md-4 mb-4">
                     <div class="how-card">
                        <h5><span class="badge bg-primary rounded-pill me-2">3</span> Generate & Send</h5>
                         <p>Review the invoice draft and confirm sending (simulated).</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQs Section: Answers common questions using Bootstrap Accordion -->
    <section class="section-bg">
        <div class="container pb-5">
            <h2 class="section-title mb-4">FAQs</h2>
            <div class="accordion" id="faqAccordion">
                <!-- FAQ Item 1 -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faqHeading1">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1" aria-expanded="true" aria-controls="faq1">
                            How does this chatbot create invoices?
                        </button>
                    </h2>
                    <div id="faq1" class="accordion-collapse collapse show" aria-labelledby="faqHeading1" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            You provide the details (client, items, prices, etc.) in the chat. The bot uses AI via the OpenRouter API to understand your input, format it into a standard invoice structure (using text and Markdown), and presents it back to you.
                        </div>
                    </div>
                </div>
                 <!-- FAQ Item 2 -->
                 <div class="accordion-item">
                    <h2 class="accordion-header" id="faqHeading2">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2" aria-expanded="false" aria-controls="faq2">
                            Can it actually send the invoice via email?
                        </button>
                    </h2>
                    <div id="faq2" class="accordion-collapse collapse" aria-labelledby="faqHeading2" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            No. This is a frontend demonstration. The chatbot can **simulate** the sending process by confirming it in the chat (e.g., "OK, I've simulated sending the invoice to client@email.com"). It cannot actually send emails or connect to your email account.
                        </div>
                    </div>
                </div>
                 <!-- FAQ Item 3 -->
                 <div class="accordion-item">
                    <h2 class="accordion-header" id="faqHeading3">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3" aria-expanded="false" aria-controls="faq3">
                            What information do I need to provide?
                        </button>
                    </h2>
                    <div id="faq3" class="accordion-collapse collapse" aria-labelledby="faqHeading3" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            Typically, you'll need: Your company details (name, address - you can provide this once), Client details (name, email, address), Invoice number, Date, Due Date, Item/Service descriptions, Quantities, Unit Prices, any applicable Taxes or Discounts. The bot may ask for missing details.
                        </div>
                    </div>
                </div>
                <!-- FAQ Item 4 -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faqHeading4">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4" aria-expanded="false" aria-controls="faq4">
                           Is my invoice data stored?
                        </button>
                    </h2>
                    <div id="faq4" class="accordion-collapse collapse" aria-labelledby="faqHeading4" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                             This webpage itself does not store your conversation or invoice data after you close it. The information you enter is sent to the OpenRouter API and processed by the AI model according to their privacy policies. Avoid entering extremely sensitive financial details if you have concerns.
                        </div>
                    </div>
                </div>
                <!-- FAQ Item 5 -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faqHeading5">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5" aria-expanded="false" aria-controls="faq5">
                            Why did the bot refuse my request?
                        </button>
                    </h2>
                    <div id="faq5" class="accordion-collapse collapse" aria-labelledby="faqHeading5" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            The bot is specifically programmed to assist with tasks related to generating invoices. It will decline requests outside this scope (e.g., asking for recipes, general knowledge, complex calculations unrelated to invoicing). Please phrase your request clearly around creating or managing an invoice.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section: Developer info and contact email -->
    <section class="contact-section">
        <div class="container">
            <h1><b>Developed by:</b></h1>
            <p id="para">Sukhpreet Singh 12307119</p>
            <p id="para">Harshit Guglani 12312754</p>
            <p id="para">Diddukoori Jashwanth 12309771</p>
            <h2 class="mt-4 section-title">Contact Us</h2>
            <p>Have questions or feedback? Reach out to us at <a href="mailto:support@invoicegeneratorbot.com">support@invoicegeneratorbot.com</a></p>
        </div>
    </section>

    <!-- Floating Chatbot Toggle Button -->
    <button class="chat-toggle-btn" onclick="toggleChat()" aria-label="Toggle Chat Window">
        <!-- Bootstrap icon for invoice/document -->
        <i class="bi bi-file-earmark-text-fill"></i>
    </button>

    <!-- Chatbot Window Container -->
    <div class="chat-container" id="chatbox">
        <!-- Chat Header: Title and Close Button, Draggable Handle -->
        <div class="chat-header" id="chatHeader">
            <span>Invoice Generator Bot</span>
            <span class="chat-close" onclick="toggleChat()" aria-label="Close Chat Window">✕</span>
        </div>
        <!-- Chat Body: Displays messages -->
        <div class="chat-body" id="response">
             <!-- Initial welcome message from the bot -->
             <p class="bot-message"><b>Bot:</b> <span class="initial-msg-content">Hi! 👋🏻 I'm the Invoice Generator Bot. Tell me the details for the invoice you want to create (client name, items, amounts, etc.), and I'll help draft it. You can also ask me to simulate sending it.</span></p>
             <!-- Typing indicator will be dynamically added here -->
        </div>
        <!-- Chat Footer: User input field and send button -->
        <div class="chat-footer">
            <input type="text" class="form-control" id="userInput" placeholder="Enter invoice details or 'send'..." aria-label="User input for chatbot">
            <button class="btn btn-primary btn-send" onclick="sendMessage()" aria-label="Send message">
                 <!-- Bootstrap send icon -->
                 <i class="bi bi-send-fill"></i>
            </button>
        </div>
    </div>

    <!-- Bootstrap 5 Bundle JS (includes Popper.js for tooltips, popovers, dropdowns, etc.) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- DOM Element References ---
        // Cache references to frequently used DOM elements for performance
        const chatbox = document.getElementById("chatbox");
        const chatHeader = document.getElementById("chatHeader");
        const responseDiv = document.getElementById('response');
        const userInput = document.getElementById('userInput');
        const toggleButton = document.querySelector('.chat-toggle-btn');
        const chatBody = document.querySelector('.chat-body'); // Needed for scrolling

        // --- CONFIGURATION ---
        // IMPORTANT: Replace 'YOUR_OPENROUTER_API_KEY_HERE' with your actual OpenRouter API key.
        // Get a key from https://openrouter.ai/
        const apiBearerToken = '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'; // <-- PASTE YOUR KEY HERE
        // Optional: Referrer and site name headers for OpenRouter analytics/moderation
        const siteUrl = 'https://your-invoice-website.com'; // Replace if hosted, otherwise can be placeholder
        const siteName = 'Invoice Generator ChatBot Page'; // Replace with your actual site title if desired
        // Specifies which AI model to use via OpenRouter
        const modelIdentifier = "google/gemini-2.0-flash-lite-001"; // Example: Google Gemini Flash (check OpenRouter for available models)

        // --- INVOICE-SPECIFIC RELEVANCE FILTER ---
        // Keywords to help determine if user input is related to invoicing
        const relevantKeywords = [
            "invoice", "bill", "client", "customer", "item", "product", "service", "description",
            "quantity", "qty", "price", "cost", "rate", "amount", "total", "subtotal", "tax", "vat",
            "discount", "due date", "payment terms", "send", "email", "generate", "create", "draft",
            "add item", "company details", "address", "invoice number", "issue date", "iban", "swift", "bank"
        ];

        // --- SYSTEM PROMPT FOR INVOICE GENERATION ---
        // Instructions given to the AI model to define its role, capabilities, and limitations.
        const systemPrompt = `You are 'Invoice Generator Bot', an AI assistant specialized **ONLY** in helping users create and manage invoices. Your primary functions are:
1.  **Gather Invoice Details:** Interact conversationally to collect necessary invoice information: Your details (if not previously provided), Client details (Name, Address, Email if needed for simulation), Invoice #, Dates (Issue, Due), Line Items (Description, Quantity, Unit Price), Taxes (percentage or amount), Discounts (percentage or amount), Payment Terms, optional Notes. Ask clarifying questions for missing essential details (like client name, items, total).
2.  **Format Invoice:** Once sufficient details are gathered, format the information clearly into a professional-looking invoice structure using Markdown. Use headings for sections (Your Info, Client Info, Items, Summary), a table for line items (Description | Qty | Unit Price | Amount), and bold text for labels and totals. Calculate line item totals and the final total amount.
3.  **Simulate Sending:** If the user asks to "send" the invoice (or similar phrasing like "email it"), acknowledge the request and confirm the *simulation* of sending (e.g., "OK, I have simulated sending the invoice draft to [Client Name/Email if provided]."). **DO NOT** imply you can actually send emails or connect to services.
4.  **Refuse Off-Topic Requests:** You **MUST REFUSE** any question or task outside the scope of invoice generation/management. If asked about unrelated topics (weather, recipes, general knowledge, coding, personal opinions, complex math not for the invoice), politely state your specialization in invoices and decline. Example refusal: "I specialize in helping with invoices. I can't assist with [user's off-topic request]. How can I help with your invoice?" Do **NOT** answer off-topic questions.

**CRITICAL:** Always use Markdown for invoice formatting, especially tables for line items. Be friendly and conversational while gathering info. Clearly state sending is a simulation. Strictly adhere to the invoice-only role. Calculate totals correctly.`;

        /**
         * Toggles the visibility of the chat window and the toggle button.
         * Manages focus and scrolling when the chat opens.
         */
        function toggleChat() {
            // Check the current display state before changing it
            const chatIsOpen = chatbox.style.display === "flex";

            if (chatIsOpen) {
                // If chat is open, hide it and show the button
                chatbox.style.display = "none";
                toggleButton.style.opacity = "1";
                toggleButton.style.visibility = "visible";
            } else {
                // If chat is closed, show it and hide the button
                chatbox.style.display = "flex";
                toggleButton.style.opacity = "0";
                toggleButton.style.visibility = "hidden";

                // Use setTimeout to ensure the element is visible before focusing/scrolling
                setTimeout(() => {
                    // Scroll to the bottom of the chat body
                    if (chatBody) {
                        chatBody.scrollTop = chatBody.scrollHeight;
                    }
                    // Focus the user input field
                    if (userInput) {
                         userInput.focus();
                    }
                }, 50); // 50ms delay allows the browser to render the chatbox
            }
        }

        /**
         * Appends a message to the chat body.
         * @param {string} sender - Who sent the message ("You" or "Bot").
         * @param {string} message - The message content (text or Markdown).
         * @param {boolean} [isHtml=false] - If true, treats the message as Markdown and renders it as HTML.
         */
        function appendMessage(sender, message, isHtml = false) {
            const messageElement = document.createElement("p");
            // Create a CSS class based on the sender (e.g., 'you-message', 'bot-message')
            const senderClass = sender.toLowerCase().replace(/\s+/g, '-');
            messageElement.classList.add(senderClass + '-message');

            // Add the sender label (e.g., "Bot:")
            const labelElement = document.createElement('b');
            labelElement.textContent = `${sender}:`;
            messageElement.appendChild(labelElement);

            // Wrap the actual message content in a span for better styling control, especially for Markdown
            const contentWrapper = document.createElement('span');
            // Add a class to the initial bot message span for potential specific styling
            if (sender === 'Bot' && message.includes("Hi! 👋🏻")) {
                contentWrapper.classList.add('initial-msg-content');
            }

            if (isHtml) {
                // If it's HTML/Markdown content, parse it using marked.js
                try {
                    // Configure marked.js for better compatibility (e.g., handle line breaks)
                    const renderedHtml = marked.parse(message, { breaks: true, gfm: true, pedantic: false, smartypants: false });
                    contentWrapper.innerHTML = renderedHtml; // Set the rendered HTML
                } catch (e) {
                     console.error("Markdown parsing error:", e);
                     contentWrapper.textContent = message; // Fallback to plain text on error
                }
            } else {
                // If it's plain text, just set the text content
                contentWrapper.textContent = message;
            }
             messageElement.appendChild(contentWrapper); // Add the content span to the message paragraph

            responseDiv.appendChild(messageElement); // Add the complete message paragraph to the chat display

             // Scroll to the bottom smoothly after the message is added
             // requestAnimationFrame ensures this runs after the browser has painted the new message
             requestAnimationFrame(() => {
                 if (chatBody) {
                     chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: 'smooth' });
                 }
             });
        }

        /**
         * Displays the typing indicator ("Bot is typing...") in the chat body.
         */
        function showTypingIndicator() {
            hideTypingIndicator(); // Remove any existing indicator first
            const typingIndicator = document.createElement("p");
            typingIndicator.id = "typingIndicator"; // ID for easy removal
             // Apply 'bot-message' class for consistent styling and layout
             typingIndicator.classList.add('bot-message');
             // Add the "Bot:" label and the animated dots
             typingIndicator.innerHTML = `<b>Bot:</b> <span class="typing-indicator"><span></span><span></span><span></span></span>`;
            responseDiv.appendChild(typingIndicator);

            // Scroll to ensure the indicator is visible
             requestAnimationFrame(() => {
                 if (chatBody) {
                     chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: 'smooth' });
                 }
             });
        }

        /**
         * Removes the typing indicator from the chat body.
         */
        function hideTypingIndicator() {
            const indicator = document.getElementById("typingIndicator");
            if (indicator) {
                indicator.remove();
            }
        }

        /**
         * Checks if the user's query seems relevant to invoice generation.
         * @param {string} query - The user's input message.
         * @returns {boolean} - True if the query seems relevant, false otherwise.
         */
        function isQueryRelevant(query) {
            const lowerCaseQuery = query.toLowerCase();
            // Check if the query contains any of the predefined relevant keywords
            const containsKeyword = relevantKeywords.some(keyword => lowerCaseQuery.includes(keyword));
            // Basic check for patterns often found in invoice data (e.g., "2 x $50", "client:", "due by", "INV-123")
            const looksLikeData = /(\d+)\s*(x|\*)\s*[$€£]?\d+(\.\d+)?/.test(lowerCaseQuery) || /client:/i.test(lowerCaseQuery) || /item:/i.test(lowerCaseQuery) || /due by/i.test(lowerCaseQuery) || /inv-?#?\s?\d+/i.test(lowerCaseQuery);
            // Consider the query relevant if it contains a keyword OR looks like invoice data
            return containsKeyword || looksLikeData;
        }

        /**
         * Sends the user's message to the AI, handles the response, and updates the chat UI.
         */
        async function sendMessage() {
            const input = userInput.value.trim();
            if (!input) return; // Don't send empty messages

             // --- API Key Check ---
             // Provide a user-friendly message if the API key is missing or looks invalid.
             if (!apiBearerToken || apiBearerToken === 'YOUR_OPENROUTER_API_KEY_HERE' || apiBearerToken.length < 50) {
                 const errorHtml = `<span style="color: orange; font-weight: bold;"><i class="bi bi-exclamation-triangle-fill me-2"></i>SETUP NEEDED:</span> Please add a valid OpenRouter API key in the script section to enable the AI features.`;
                 appendMessage("Bot", errorHtml, true); // Display setup message as HTML
                 userInput.value = ""; // Clear input field
                 return; // Stop processing
            }

            // Clear the input field immediately and display the user's message
            userInput.value = "";
            appendMessage("You", input);

            // --- Relevance Check ---
            // Check if the input is related to invoices before sending to the API
            if (!isQueryRelevant(input)) {
                console.log("Query deemed irrelevant:", input); // Log for debugging
                // Provide a polite refusal message if the query is off-topic
                const refusalMessage = "My apologies, I specialize only in creating and managing invoices. I can't help with unrelated topics. How can I assist with your invoice?";
                 // Use setTimeout to ensure the refusal appears after the user's message
                 setTimeout(() => {
                     appendMessage("Bot", refusalMessage);
                     if (userInput) userInput.focus(); // Return focus to input field
                 }, 300); // 300ms delay
                return; // Stop processing
            }

            // If relevant, proceed to send to AI
            console.log("Query relevant, sending to AI:", input); // Log for debugging
            showTypingIndicator(); // Show "Bot is typing..."

            // --- Build Conversation History ---
            // Start with the system prompt
            const messages = [{ "role": "system", "content": systemPrompt }];
            // Get all previous messages from the chat UI (excluding the typing indicator)
            const chatHistory = responseDiv.querySelectorAll('p:not(#typingIndicator)');

            chatHistory.forEach(p => {
                const labelElement = p.querySelector('b'); // Find the sender label (<b>)
                if (!labelElement) return; // Skip malformed paragraphs

                const sender = labelElement.textContent.replace(':', '').trim(); // "You" or "Bot"
                const contentWrapper = p.querySelector('span'); // Find the content span
                let content = '';

                 if (contentWrapper) {
                     // For bot messages that might contain HTML (from Markdown), use innerHTML
                     // For user messages, use plain text content
                     if (p.classList.contains('bot-message')) {
                         content = contentWrapper.innerHTML.trim(); // Send back potentially rendered HTML
                     } else {
                         content = contentWrapper.textContent.trim(); // Send back plain text
                     }
                 } else {
                     // Fallback if the span structure isn't found (shouldn't happen now)
                     content = p.textContent.substring(p.textContent.indexOf(':') + 1).trim();
                 }

                 // Add the message to the history array if it has content and isn't the setup warning
                 if (sender === 'You' && content) {
                    messages.push({ "role": "user", "content": content });
                } else if (sender === 'Bot' && content && !content.includes('SETUP NEEDED')) {
                    messages.push({ "role": "assistant", "content": content }); // Use assistant role for bot
                }
            });
             // Add the current user input as the last message
             messages.push({ "role": "user", "content": input });
             // console.log("Sending messages:", JSON.stringify(messages, null, 2)); // Uncomment to debug message history

            // --- API Call using Fetch ---
            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiBearerToken}`, // API Key
                        'Content-Type': 'application/json',
                        // Optional Headers (Recommended by OpenRouter)
                        // 'HTTP-Referer': siteUrl,
                        // 'X-Title': siteName
                    },
                    body: JSON.stringify({
                        "model": modelIdentifier, // The chosen AI model
                        "messages": messages, // The conversation history
                        "temperature": 0.6, // Controls randomness (0=deterministic, >1=more creative)
                        "max_tokens": 1500, // Max length of the AI's response
                        // "stream": false, // Set to true for streaming responses (requires different handling)
                    }),
                });

                hideTypingIndicator(); // Remove "typing..." indicator once response starts processing

                // --- Handle API Response ---
                if (!response.ok) {
                    // Handle HTTP errors (e.g., 401 Unauthorized, 402 Payment Required, 429 Rate Limit, 5xx Server Error)
                    let errorDetails = `HTTP Error: ${response.status} ${response.statusText}`;
                    try {
                         // Attempt to parse error details from the response body
                         const errorData = await response.json();
                         console.error("API Error Response:", errorData); // Log detailed error
                         errorDetails += ` - ${errorData.error?.message || 'No additional details provided.'}`;
                          // Add helpful hints based on common status codes
                          if(response.status === 401) errorDetails += " (Check your API Key)";
                          if(response.status === 402) errorDetails += " (Check your OpenRouter account credits)";
                          if(response.status === 429) errorDetails += " (Rate limit exceeded. Please wait and try again)";
                          if(response.status >= 500) errorDetails += " (An error occurred on the AI provider's server)";
                    } catch (e) { /* Ignore if response body is not JSON */ }
                     // Display a user-friendly error message in the chat
                     const errorHtml = `<span style="color: red; font-weight: bold;"><i class="bi bi-x-octagon-fill me-2"></i>API Error:</span> ${errorDetails}`;
                     appendMessage("Bot", errorHtml, true);
                    return; // Stop execution for this message
                }

                // Parse the successful JSON response
                const data = await response.json();
                console.log("API Success Response:", data); // Log successful response for debugging

                // Extract the AI's message content
                const botResponse = data.choices?.[0]?.message?.content;

                if (botResponse) {
                    // Append the AI's response, rendering any Markdown as HTML
                    appendMessage("Bot", botResponse.trim(), true);
                } else {
                     // Handle cases where the response structure is unexpected
                     console.error("Empty or malformed response content:", data);
                     appendMessage("Bot", "Sorry, I received an unexpected response from the AI. Could you please try rephrasing?");
                }

            } catch (error) {
                // Handle network errors (e.g., fetch failed, no internet connection)
                hideTypingIndicator();
                console.error("Network/Fetch Error:", error);
                 // Display a user-friendly network error message
                 const errorHtml = `<span style="color: red; font-weight: bold;"><i class="bi bi-wifi-off me-2"></i>Network Error:</span> ${error.message}. Please check your internet connection.`;
                 appendMessage("Bot", errorHtml, true);
            } finally {
                 // Ensure the input field is focused after processing is complete (success or error)
                 if (userInput) userInput.focus();
            }
        }

        // --- EVENT LISTENERS ---
        // Send message when Enter key is pressed in the input field
        if (userInput) {
            userInput.addEventListener('keypress', function (event) {
                // Check if the key pressed is Enter and Shift key is not held down
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault(); // Prevent default Enter behavior (e.g., new line in textarea)
                    sendMessage(); // Call the sendMessage function
                }
            });
        }

        // --- INITIALIZATION ---
        // Run when the DOM is fully loaded and parsed
        window.addEventListener('DOMContentLoaded', (event) => {
             // Ensure the chatbox is hidden by default when the page loads
             if (chatbox) chatbox.style.display = "none";
             // Make the chat window draggable using its header
             if (chatbox && chatHeader) makeDraggable(chatbox, chatHeader);

             // Pre-render the initial bot message if it contains Markdown
             const initialBotMsgContent = responseDiv.querySelector('.initial-msg-content');
             if (initialBotMsgContent) {
                 try {
                     const initialHtml = marked.parse(initialBotMsgContent.textContent || '', { breaks: true, gfm: true });
                     initialBotMsgContent.innerHTML = initialHtml;
                 } catch (e) {
                     console.error("Error parsing initial message markdown:", e);
                     // If parsing fails, the original text content remains
                 }
             }
        });


        // --- DRAGGING FUNCTIONALITY ---
        /**
         * Makes an HTML element draggable within the viewport.
         * @param {HTMLElement} element - The element to make draggable.
         * @param {HTMLElement} handle - The element that acts as the drag handle (e.g., the header).
         */
         function makeDraggable(element, handle) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0; // Positions: pos1/2 = change, pos3/4 = start
            let isDragging = false; // Flag to track if dragging is active

             // Use the specified handle element for dragging, otherwise the whole element
             const dragHandle = handle || element;

             // Attach mouse down and touch start listeners to the handle
             dragHandle.onmousedown = dragMouseDown;
             dragHandle.ontouchstart = dragMouseDown;


            function dragMouseDown(e) {
                // Prevent default behavior only for mouse events initially to allow scrolling on touch
                 if (e.type === 'mousedown') {
                    // Allow dragging only with the primary mouse button (button 0)
                    if (e.button !== 0) return;
                     e.preventDefault(); // Prevent text selection, etc.
                 }

                 // Get the initial cursor/touch position
                 if (e.type === 'touchstart') {
                     pos3 = e.touches[0].clientX;
                     pos4 = e.touches[0].clientY;
                 } else {
                     pos3 = e.clientX;
                     pos4 = e.clientY;
                 }

                // Attach listeners to the document to track mouse/touch movement and release anywhere on the page
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
                 // Touch equivalents
                 document.ontouchend = closeDragElement;
                 document.ontouchmove = elementDrag;

                isDragging = true;
                // Temporarily disable CSS transitions during drag for smoother movement
                element.style.transition = 'none';
                 // Change cursor to indicate grabbing action
                 dragHandle.style.cursor = 'grabbing';
            }

            function elementDrag(e) {
                if (!isDragging) return; // Only run if dragging is active

                // Prevent default page scroll/zoom on touch devices while dragging the element
                 e.preventDefault();

                 // Calculate the new cursor/touch position
                 let currentX, currentY;
                 if (e.type === 'touchmove') {
                     currentX = e.touches[0].clientX;
                     currentY = e.touches[0].clientY;
                 } else {
                     currentX = e.clientX;
                     currentY = e.clientY;
                 }

                // Calculate the distance the cursor/touch has moved
                pos1 = pos3 - currentX; // Horizontal change
                pos2 = pos4 - currentY; // Vertical change
                // Update the starting position for the next movement calculation
                pos3 = currentX;
                pos4 = currentY;

                // Calculate the new element's top and left position
                let newTop = element.offsetTop - pos2;
                let newLeft = element.offsetLeft - pos1;

                // --- Boundary Collision Detection ---
                // Get viewport dimensions and element dimensions
                const maxTop = window.innerHeight - element.offsetHeight;
                const maxLeft = window.innerWidth - element.offsetWidth;

                 // Constrain the element within the viewport boundaries
                 newTop = Math.max(0, Math.min(newTop, maxTop)); // Clamp top between 0 and maxTop
                 newLeft = Math.max(0, Math.min(newLeft, maxLeft)); // Clamp left between 0 and maxLeft

                // Set the element's new position using top/left
                element.style.top = newTop + "px";
                element.style.left = newLeft + "px";
                 // Remove bottom/right positioning if previously set, as top/left take precedence during drag
                 element.style.bottom = 'auto';
                 element.style.right = 'auto';
            }

            function closeDragElement() {
                // Stop dragging when mouse button is released or touch ends
                // Remove document-level listeners
                document.onmouseup = null;
                document.onmousemove = null;
                 document.ontouchend = null;
                 document.ontouchmove = null;

                isDragging = false; // Reset dragging flag
                 // Re-enable CSS transitions if they were defined
                 element.style.transition = '';
                 // Restore the default grab cursor on the handle
                 dragHandle.style.cursor = 'grab';
            }
        }

    </script>

</body>
</html>
